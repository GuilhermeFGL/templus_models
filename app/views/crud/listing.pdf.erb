<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<div class="widget-box" id="relatorio">
  <div class="widget-body">
    <div class="widget-main">

      <% unless @crud_helper.setup_report_listing[:header].present? %>
        <div class="row">
          <div class="col-lg-12">
            <h2>
              <small><%= @crud_helper.title %></small><br />
            </h2>
          </div>
        </div>
      <% end %>


      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <% @crud_helper.listing_fields.each do |att| %>
              <% next if att[:sf][:only] == :excel %>
              <% if !att[:visible_if].nil? %>
                <% if ((att[:visible_if].class == Proc && !att[:visible_if].call(att)) || (att[:visible_if].class != Proc && !att[:visible_if])) %>
                  <% next %>
                <% end %>
              <% end %>
              <th><%= I18n.t(att[:sf][:label]) %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% @records.each do |record| %>
            <tr>
              <% @crud_helper.listing_fields.each do |att| %>
                <% next if att[:sf][:only] == :excel %>

                <td width="<%= att[:sf][:width] if att[:sf][:width].present? %>" height="<%= att[:sf][:height] if att[:sf][:height].present? %>">
                <% if record.send(att[:attribute]).present? || record.send(att[:attribute]).to_s == "false" %>                  
                  <% if @model.columns_hash[att[:attribute].to_s].present? && [:date, :datetime].include?(@model.columns_hash[att[:attribute].to_s].type)%>
                    <% if att[:date_format].present?%>
                      <%= record.send(att[:attribute]).strftime(att[:date_format]) %>
                    <% else %>
                      <%= l record.send(att[:attribute]) %>
                    <% end %>
                  <% elsif array?(record, att[:attribute]) || (association?(@model, att[:attribute]) && !belongs_to_association?(@model, att[:attribute]) && !has_one_association?(@model, att[:attribute])) %>
                    <%= record.send(att[:attribute]).map{|rec| rec.to_s}.join(",") %>
                  <% elsif boolean?(record, att[:attribute]) %>
                    <%= I18n.t(record.send(att[:attribute]) ? "shared.sim" : "shared.nao") %>
                  <% elsif possui_url?(record, att[:attribute]) %>
                    <% if deve_renderizar_imagem?(att[:sf]) %>
                      <%= render_field_file(record.send(att[:attribute])) %>
                    <% else %>
                      <%= record.send(att[:attribute]).url %>
                    <% end %>
                  <% elsif att[:sf][:label_method].present? %>
                    <%= record.send(att[:attribute]).send(att[:sf][:label_method]).to_s %>
                  <% else %>
                    <%= record.send(att[:attribute]).to_s %>
                  <% end %>
                <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
  #relatorio {
    clear: both;
    page-break-inside: avoid;
  }
  .header {
    float: left;
  }
  table {
    font-size: 0.75em;
  }
  thead { display: table-header-group }
  tfoot { display: table-row-group }
  tr { page-break-inside: avoid }
  h1 { padding-bottom: 20px; }
</style>
