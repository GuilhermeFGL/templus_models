<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<div class="widget-box" id="relatorio">
  <div class="widget-body">
    <div class="widget-main">

      <div class="row">
        <div class="col-lg-12">
          <h2>
            <% unless @crud_helper.setup_report_printing[:header].present? %>
              <small><%= @crud_helper.title %></small><br />
            <% end %>
            <%= @record.to_s %>
          </h2>
        </div>
      </div>

      <table class="table table-bordered table-striped">
        <tbody>
          <% @crud_helper.printing_fields.each do |field| %>
            <% next if field[:sf].present? && !field[:sf][:visible_if].nil? && ((field[:sf][:visible_if].class == Proc && !field[:sf][:visible_if].call(@record)) || (field[:sf][:visible_if].class != Proc && !field[:sf][:visible_if])) %>
            <tr>
              <th><%= I18n.t(field[:sf][:label]) %></th>
              <td width="<%= field[:sf][:width] if field[:sf][:width].present? %>" height="<%= field[:sf][:height] if field[:sf][:height].present? %>">
                <% if @model.columns_hash[field[:attribute].to_s].present? && [:date, :datetime].include?(@model.columns_hash[field[:attribute].to_s].type) %>
                  <% if field[:date_format].present?%>
                    <%= l @record.send(field[:attribute]).strftime(field[:date_format]) if @record.send(field[:attribute]).present? %>
                  <% else %>
                    <%= l @record.send(field[:attribute]) if @record.send(field[:attribute]).present? %>
                  <% end %>
                <% elsif association?(@model, field[:attribute]) && !belongs_to_association?(@model, field[:attribute]) && !has_one_association?(@model, field[:attribute]) %>
                  <% @record.send(field[:attribute]).each do |rec| %>
                    <li>
                      <% if field[:sf].present? && field[:sf][:label_method].present? %>
                        <% if possui_url?(rec, field[:sf][:label_method]) && deve_renderizar_imagem?(field[:sf]) %>
                          <% if deve_renderizar_imagem?(field[:sf]) %>
                            <%= render_field_file(rec.send(field[:sf][:label_method])) %>
                          <% else %>
                            <%= rec.send(field[:sf][:label_method]).url %>
                          <% end %>
                        <% else %>
                          <%= rec.send(field[:sf][:label_method]) %>
                        <% end %>
                      <% else %>
                        <% if rec.respond_to?(:url) && deve_renderizar_imagem?(field[:sf]) %>
                          <%= render_field_file(rec.to_s) %>
                        <% else %>
                          <%= rec.to_s %>
                        <% end %>
                      <% end %>
                    </li>
                  <% end %>
                <% elsif array?(@record, field[:attribute]) %>
                  <% @record.send(field[:attribute]).each do |rec| %>
                    <li><%= rec.to_s %></li>
                  <% end %>
                <% elsif possui_url?(@record, field[:attribute]) %>
                  <% if deve_renderizar_imagem?(field[:sf]) %>
                    <%= render_field_file(@record.send(field[:attribute])) %>
                  <% else %>
                    <%= @record.send(field[:attribute]).url %>
                  <% end %>
                <% elsif boolean?(@record, field[:attribute]) %>
                  <%= I18n.t(@record.send(field[:attribute]) ? "shared.sim" : "shared.nao") %>
                <% else %>
                  <% if field[:sf].present? && field[:sf][:label_method].present? && @record.send(field[:attribute]).present?%>
                    <%= @record.send(field[:attribute]).send(field[:sf][:label_method]) %>
                  <% else %>
                    <%= @record.send(field[:attribute]) %>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<style>
  #relatorio {
    clear: both;
    page-break-inside: avoid;
  }
  .header {
    float: left;
  }
  table {
    font-size: 0.75em;
  }
  thead { display: table-header-group }
  tfoot { display: table-row-group }
  tr { page-break-inside: avoid }
  h1 { padding-bottom: 20px; }
</style>
