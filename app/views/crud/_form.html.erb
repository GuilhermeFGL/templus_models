<div class="modal inmodal" id="modal_new_record" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content animated bounceInRight">
			<div class="modal-body">
			</div>
	    <div class="modal-footer">
	        <button type="button" class="btn btn-white" data-dismiss="modal">Cancelar</button>
	    </div>
		</div>
	</div>
</div>

<%unless params[:render] == 'modal'%>
	<% url = "/crud/#{@model.name.underscore}/#{@record.new_record? ? 'create' : @record.id.to_s+'/create'}" %>
	<% remote_form = false%>
<%else%>
	<% url = "/crud/#{@model.name.underscore}/#{@record.new_record? ? 'create?render=modal' : @record.id.to_s+'/create?render=modal'}" %>
	<% remote_form = true%>
<%end%>
<%= simple_nested_form_for @record, remote: remote_form, html: {class: "form-horizontal"}, url: url do |f| %>
	<%= f.error_notification %>
	<%@crud_helper.form_fields.each do |field|%>
		<% if @model.reflect_on_association(field[:attribute]).class == ActiveRecord::Reflection::BelongsToReflection and is_raro_crud(field[:attribute]) %>
				<%= render_plus_button(field,f,@model,@record) %>
		<%else%>
				<%= render_field(field,f,@model,@record) %>
		<%end%>
		
	<% end %>
	<%@crud_helper.form_groups.each do |key, groups|%>
		<% if [:has_many,:has_and_belongs_to_many].include?(@model.reflect_on_association(key).macro) && @record.new_record? %>
			<% @record.send(key).build %>
		<% elsif @record.new_record?%>
				<% @record.send("build_#{key}") %>
		<% end %>
		<%= f.simple_fields_for key do |g| %>
			<% groups.each do |field| %>
				<%= render_field(field,g,@model,@record) %>
			<% end %>
			<% if [:has_many,:has_and_belongs_to_many].include?(@model.reflect_on_association(key).macro) %>
				<div class="form-group">
					<div class="col-sm-10 col-sm-offset-2">
						<%= g.link_to_remove 'remove' %>
					</div>
				</div>
			<% end %>
		<% end %>
		<% if [:has_many,:has_and_belongs_to_many].include?(@model.reflect_on_association(key).macro) %>
			<div class="form-group">
				<div class="col-sm-12">
					<%= f.link_to_add 'Adicionar', key %>
				</div>
			</div>
		<% else %>
	<% end %>
	<div class="form-group">
		<div class="col-sm-4 col-sm-offset-2">
			<%= f.submit "Salvar", class: 'btn btn-primary'  %>
		</div>
	</div>
<% end %>
<% @crud_helper.form_scripts.each do |script| %>
<%= javascript_include_tag "crud/#{script}" %>
<% end %>

